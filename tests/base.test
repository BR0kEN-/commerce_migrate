<?php

abstract class CommerceMigrateBaseTest extends CommerceBaseTestCase {
  /**
   * Don't need most of default core modules.
   */
  protected $profile = 'minimal';

  protected $store_admin;

  /**
   * Overrides CommerceBaseTestCase::permissionBuilder().
   */
  protected function permissionBuilder($set) {
    $permissions = parent::permissionBuilder($set);

    switch ($set) {
      case 'store admin':
      case 'site admin':
        $permissions[] = MIGRATE_ACCESS_BASIC;
        $permissions[] = MIGRATE_ACCESS_ADVANCED;
        break;
    }

    return $permissions;
  }

  /**
   * Overrides DrupalWebTestCase::setUp().
   */
  function setUp() {
    $modules   = parent::setUpHelper('all');
    $modules[] = 'migrate';
    $modules[] = 'migrate_extras';
    $modules[] = 'commerce_migrate';
    $modules[] = 'commerce_migrate_example';
    parent::setUp($modules);
    $this->resetAll();

    // Make sure the migrations are registered.
    migrate_static_registration();

    $this->store_admin = $this->createStoreAdmin();

    if (!$this->store_admin) {
      $this->fail(t('Failed to create Store Admin user for test.'));
    }

    // Set the default country to US.
    variable_set('site_default_country', 'US');
  }
}
